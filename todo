Wykorzystaj fakt, że na podstawie odpowiedzi można zidentyfikować do jakiego pakietu należą: 

komunikaty ICMP echo reply zawierają te same pola identifier i sequence number,

zaś komunikaty ICMP time exceeded zawierają oryginalny nagłówek IP i 8 bajtów oryginalnego pakietu IP (czyli w w przypadku odpowiedzi na ICMP echo request cały oryginalny nagłówek ICMP).

---------------

ICMP time exceeded → zawierają cały oryginalny nagłówek IP i i ICMP
ICMP echo replay → te same pola identifier i sequence number

1. Wyślij 3 pakiety echo request. Zapamiętaj nagłówki ICMP tych pakietów.
2. Czekaj selectem X sekund. Jeżeli są jakieś pakiety to:
	- sprawdź czy są to te pakiety, co właśnie wysłałeś
	- jak tak, to policz czas, stututu
3. Jeżeli dostałeś echo replay, to koniec


30      Received IP packet with ICMP content from: 212.77.98.9
IP header: 	45 00 00 1c 9f 51 00 00 36 01 c3 4b d4 4d 62 09 c0 a8 2b 45 
IP data:	00 00 ca f0 18 0f 1d 00 
			^  ^  ^		^     ^
			ty 2  id    suma  sekwencyj
			


Bit 0 7		8 15 	16 23	24 31
	Typ		Kod		Suma kontrolna
	identyfikator	nr sekwencyjny

Dane (opcjonalne)
			

OBSERWCJA
timeval jest aktualizowane przez select


_wp.pl_________
PIERWOTNY:

IP header: 45 40 00 60 5f af 00 00 fd 01 f3 bf ac 14 fd 25 c0 a8 00 0b 
IP data:   type: time exceeded
0b 00 f4 ee 00 11 00 00.45 00 00 1c a2 64 40 00 00 01 e1 72 c0 a8 00 0b d4 4d 62 09.08 00 36 d3 c1 2c 00 00.00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
_______________
ANALIZA:

IP header:
1...                                                  ...20 B
45 40 00 60 5f af 00 00 fd 01 f3 bf ac 14 fd 25 c0 a8 00 0b 

IP data:   type: time exceeded

icmp:
0b 00 f4 ee 00 11 00 00 

ip header(old, sent back)
45 00 00 1c a2 64 40 00 00 01 e1 72 c0 a8 00 0b d4 4d 62 09 

icmp (old, sent back)
08 00 36 d3 c1 2c 00 00 

(wtf?)
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00



--------------
--------------
__ii__________
pierwotny

IP header: 
45 40 00 60 a5 34 00 00 fd 01 ae 3a ac 14 fd 25 c0 a8 00 0b 
IP data:   type: time exceeded

0b 00 f4 ee 00 11 00 00.45 00 00 1c 75 c5 40 00 00 01 a4 56 c0 a8 00 0b 9c 11 04 01.08 00 54 f7 a3 08 00 00.00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 

______________
ANALIZA

IP header: 
45 40 00 60 a5 34 00 00 fd 01 ae 3a ac 14 fd 25 c0 a8 00 0b 

IP data:   type: time exceeded

icmp:
0b 00 f4 ee 00 11 00 00 

ipheader(old, sent back)
45 00 00 1c 75 c5 40 00 00 01 a4 56 c0 a8 00 0b 9c 11 04 01 

icmp(old, sent back)
08 00 54 f7 a3 08 00 00 

(wtf?)
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 




___________________



void print_as_bytes (unsigned char* buff, ssize_t length) {
	for (ssize_t i = 0; i < length; i++, buff++)
		printf ("%.2x ", *buff);	
}

void print_as_bytes_ip_data (unsigned char* buff, ssize_t length) {
	if(*buff == 0) printf("type: echo replay\n");
	if(*buff == 11) printf("type: time exceeded\n");
	print_as_bytes(buff, length);	
}







